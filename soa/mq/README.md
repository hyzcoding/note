# 消息队列

## 简介

> 作为中间件，把要传输的数据放在队列中

## 作用

> 1. 解耦
>
>    数据提供者无需关心数据的处理对接问题。
>
> 2. 异步
>
>    提高用户体验及系统吞吐量。
>
> 3. 削峰/限流
>
>    消费系统可根据自身系统的并发量处理数据。

## 需要解决的问题

 > 重复消费(保证消息消费的幂等性):
 >
 > ​	保证多条相同的数据过来的时候只处理一条或者说多条处理和处理一条造成的结果相同
 >
 > 消息丢失:
 >
 > 	- 生产者：开启confirm模式，需要维护每个消息id的状态，以及重发机制。
 > 	- 中间件：开启持久化。
 > 	- 消费者：
 >
 > 顺序消费：
 >
 > 



 > 1. 数据一致性
 >
 >    使用分布式事务，一起成功或失败
 >
 > 2. 高可用性
 >
 >    

## Kafka、ActiveMQ、RabbitMQ、RocketMQ 有什么优缺点？

|            | ActiveMQ                                                | RabbitMQ                                                     | RocketMQ                                                     | Kafka                                                        | ZeroMQ               |
| ---------- | ------------------------------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | -------------------- |
| 单机吞吐量 | 比RabbitMQ低                                            | 2.6w/s（消息做持久化）                                       | 11.6w/s                                                      | 17.3w/s                                                      | 29w/s                |
| 开发语言   | Java                                                    | Erlang                                                       | Java                                                         | Scala/Java                                                   | C                    |
| 主要维护者 | Apache                                                  | Mozilla/Spring                                               | Alibaba                                                      | Apache                                                       | iMatix，创始人已去世 |
| 成熟度     | 成熟                                                    | 成熟                                                         | 开源版本不够成熟                                             | 比较成熟                                                     | 只有C、PHP等版本成熟 |
| 订阅形式   | 点对点(p2p)、广播（发布-订阅）                          | 提供了4种：direct, topic ,Headers和fanout。fanout就是广播模式 | 基于topic/messageTag以及按照消息类型、属性进行正则匹配的发布订阅模式 | 基于topic以及按照topic进行正则匹配的发布订阅模式             | 点对点(p2p)          |
| 持久化     | 支持少量堆积                                            | 支持少量堆积                                                 | 支持大量堆积                                                 | 支持大量堆积                                                 | 不支持               |
| 顺序消息   | 不支持                                                  | 不支持                                                       | 支持                                                         | 支持                                                         | 不支持               |
| 性能稳定性 | 好                                                      | 好                                                           | 一般                                                         | 较差                                                         | 很好                 |
| 集群方式   | 支持简单集群模式，比如’主-备’，对高级集群模式支持不好。 | 支持简单集群，'复制’模式，对高级集群模式支持不好。           | 常用 多对’Master-Slave’ 模式，开源版本需手动切换Slave变成Master | 天然的‘Leader-Slave’无状态集群，每台服务器既是Master也是Slave | 不支持               |
| 管理界面   | 一般                                                    | 较好                                                         | 一般                                                         | 无                                                           | 无                   |

[消息队列常见问题和解决方案]: https://blog.csdn.net/qq_36236890/article/details/81174504

